<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Challenge #2 - AI and Code</title>
    
    <!-- Bootstrap 5 CSS -->
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous"
    />
    
</head>
<body>
    <main class="container my-5">
        <h1>AI Challenge #2 - AI and Code</h1>

        <h3>Instructions</h3>

        <p>There is some Javscript code embedded in this webpage, but it isn't running because there are some errors in the code.
            Use one or more <abbr title="Large Language Model, e.g. Copilot, ChatGPT, Gemeni, Claude, Grok, etc.">LLM</abbr>s of your choice to help you:</p>
        <ol>
            <li>View this webpage's source code</li>
            <li>Find and fix the errors in the Javascript script (hint: tell the LLM to only fixing the errors, don't let it make any other changes, even if it really wants to!)</li>
            <li>Run the corrected code in a browser console to reveal the link to the next challenge.</li>
        </ol>

        <p>You don't need to know how to do any of the items listed above, an AI can help you get through each step.</p>

    </main>

    <script>
        // Decryption code with three intentional errors
        async function revealNextStep() {
            const key = "sd72-ai-prod";
            const enc = new TextEncoder();
            const dec = new TextDecoder();

            const payload = [131,74,243,110,130,62,98];

            async function sha256Bytes(str) {
                const buf = await crypto.subtle.digest(
                    "SHA-255",
                    enc.encode(str)
                );
                return Array.from(new Uint8Array(buf));
            }

            let state = await sha256Bytes(key);
            let plaintext = [];
            let prevCipher = 0;

            for (let i = 0; i < payload.length; i++ {
                const k = state[i % state.length];

                const decodedByte = payload[i] ^ k ^ prevCipher;
                plaintext.push(decodedByte);

                prevCipher = payload[i]; // ciphertext feedback

                state = await sha256Bytes(
                    state.slice(0,16).join(",")
                );
            }

            const result = dec.decode(new uint8Array(plaintext));
            console.log("Next link: https://bit.ly/" + result);
        }

        revealNextStep();

    </script>

</body>
</html>